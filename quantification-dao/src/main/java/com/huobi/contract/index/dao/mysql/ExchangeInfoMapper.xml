<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.huobi.contract.index.dao.ExchangeInfoMapper">
	<resultMap id="BaseResultMap" type="com.huobi.contract.index.entity.ExchangeInfo">
		<id column="exchange_id" property="exchangeId" jdbcType="BIGINT"/>
		<result column="full_name" property="fullName" jdbcType="VARCHAR"/>
		<result column="short_name" property="shortName" jdbcType="VARCHAR"/>
		<result column="is_valid" property="isValid" jdbcType="SMALLINT"/>
		<result column="remark" property="remark" jdbcType="VARCHAR"/>
		<result column="input_by" property="inputBy" jdbcType="VARCHAR"/>
		<result column="input_time" property="inputTime" jdbcType="TIMESTAMP"/>
		<result column="updator" property="updator" jdbcType="VARCHAR"/>
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
	</resultMap>
	<resultMap id="ExchangeIndexMap" type="com.huobi.contract.index.dto.ExchangeIndex">
		<result column="exchange_id" property="exchangeId" jdbcType="BIGINT"/>
		<result column="index_symbol" property="indexSymbol" jdbcType="VARCHAR"/>
		<result column="source_symbol" property="sourceSymbol" jdbcType="VARCHAR"/>
		<result column="exchange_symbol" property="exchangeSymbol" jdbcType="VARCHAR"/>
		<result column="original_weight" property="originalWeight" jdbcType="BIGINT"/>
		<result column="full_name" property="fullName" jdbcType="VARCHAR"/>
		<result column="short_name" property="shortName" jdbcType="VARCHAR"/>
		<result column="is_valid" property="isValid" jdbcType="SMALLINT"/>
		<result column="ws_qualified" property="wsQualified" jdbcType="SMALLINT"/>
		<result column="http_qualified" property="httpQualified" jdbcType="SMALLINT"/>
		<result column="indexvalid" property="indexIsValid" jdbcType="SMALLINT"/>
	</resultMap>
	<sql id="Base_Column_List">
    exchange_id, full_name, short_name, is_valid, remark, input_by, input_time, updator, 
    update_time
  </sql>
	<select id="getExchangeByShortName" resultMap="BaseResultMap" parameterType="java.lang.String">
		select
		<include refid="Base_Column_List"/>
		from exchange_info
		where short_name = #{shortName,jdbcType=VARCHAR}
	</select>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long">
		select
		<include refid="Base_Column_List"/>
		from exchange_info
		where exchange_id = #{exchangeId,jdbcType=BIGINT}
	</select>
	<select id="getValidIndexByExchangeName" resultMap="ExchangeIndexMap" parameterType="java.lang.String">
        SELECT
			e.exchange_id,
			i.index_symbol,
			ec.source_symbol,
			ec.exchange_symbol,
			ec.weight as original_weight,
			e.full_name,
			e.short_name,
			e.is_valid,
			ec.http_qualified,
			ec.ws_qualified,
			i.is_valid AS indexvalid
        FROM
            exchange_index_weight_conf ec
            LEFT JOIN exchange_info e ON ec.exchange_id = e.exchange_id
            LEFT JOIN index_info i ON ec.index_symbol = i.index_symbol
        WHERE
        	i.is_valid = 1
			and e.is_valid = 1
			and e.short_name = #{exhangeName}
  	</select>
	<select id="getValidExchangeIndexBySymbol" resultMap="ExchangeIndexMap" parameterType="java.lang.String">
        SELECT
			e.exchange_id,
			i.index_symbol,
			ec.source_symbol,
			ec.exchange_symbol,
			ec.weight as original_weight,
			e.full_name,
			e.short_name,
			e.is_valid,
			ec.http_qualified,
			ec.ws_qualified,
			i.is_valid AS indexvalid
        FROM
            exchange_index_weight_conf ec
            LEFT JOIN exchange_info e ON ec.exchange_id = e.exchange_id
            LEFT JOIN index_info i ON ec.index_symbol = i.index_symbol
        WHERE
        	i.is_valid = 1
			and e.is_valid = 1
			and i.index_symbol = #{symbol}
  	</select>
	<select id="listValidExchangeIndex" resultMap="ExchangeIndexMap">
		SELECT
			e.exchange_id,
			i.index_symbol,
			ec.source_symbol,
			ec.exchange_symbol,
			ec.weight as original_weight,
			e.full_name,
			e.short_name,
			e.is_valid,
			ec.http_qualified,
			ec.ws_qualified,
			i.is_valid AS indexvalid
	FROM
			exchange_index_weight_conf ec
			LEFT JOIN exchange_info e ON ec.exchange_id = e.exchange_id
			LEFT JOIN index_info i ON ec.index_symbol = i.index_symbol

	WHERE
			i.is_valid = 1
			and e.is_valid = 1

	</select>
	<select id="getMidNumberId" resultMap="BaseResultMap" parameterType="java.lang.String">
		select
		<include refid="Base_Column_List"/> from exchange_info
		where short_name = #{shortName,jdbcType=VARCHAR}
	</select>
	<select id="findByNameAndSymbol" resultMap="ExchangeIndexMap">
		SELECT
			e.exchange_id,
			i.index_symbol,
			ec.source_symbol,
			ec.exchange_symbol,
			ec.weight as original_weight,
			e.full_name,
			e.short_name,
			e.is_valid,
			ec.http_qualified,
			ec.ws_qualified,
			i.is_valid AS indexvalid
		FROM
			exchange_index_weight_conf ec,
			exchange_info e,
			index_info i
		WHERE
			ec.exchange_id = e.exchange_id
		AND ec.index_symbol = i.index_symbol
		AND i.is_valid = 1
		AND e.is_valid = 1
		AND e.short_name = #{shortName}
		and ec.index_symbol= #{symbol}
	</select>
	<select id="getAllExchangeIndex" resultMap="ExchangeIndexMap">
		SELECT
			e.exchange_id,
			i.index_symbol,
			ec.source_symbol,
			ec.exchange_symbol,
			ec.weight as original_weight,
			e.full_name,
			e.short_name,
			e.is_valid,
			ec.http_qualified,
			ec.ws_qualified,
			i.is_valid AS indexvalid
		FROM
			exchange_index_weight_conf ec,
			exchange_info e,
			index_info i
		WHERE
			i.is_valid = 1
			and e.is_valid = 1
		AND	ec.exchange_id = e.exchange_id
		AND ec.index_symbol = i.index_symbol
		AND e.short_name = #{exhangeName}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    delete from exchange_info
    where exchange_id = #{exchangeId,jdbcType=BIGINT}
  </delete>
	<insert id="insert" parameterType="com.huobi.contract.index.entity.ExchangeInfo">
    insert into exchange_info (exchange_id, full_name, short_name, 
      is_valid, remark, input_by, 
      input_time, updator, update_time
      )
    values (#{exchangeId,jdbcType=BIGINT}, #{fullName,jdbcType=VARCHAR}, #{shortName,jdbcType=VARCHAR}, 
      #{isValid,jdbcType=SMALLINT}, #{remark,jdbcType=VARCHAR}, #{inputBy,jdbcType=VARCHAR}, 
      #{inputTime,jdbcType=TIMESTAMP}, #{updator,jdbcType=VARCHAR}, #{updateTime,jdbcType=TIMESTAMP}
      )
  </insert>
	<insert id="insertSelective" parameterType="com.huobi.contract.index.entity.ExchangeInfo">
		insert into exchange_info
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="exchangeId != null">
				exchange_id,
			</if>
			<if test="fullName != null">
				full_name,
			</if>
			<if test="shortName != null">
				short_name,
			</if>
			<if test="isValid != null">
				is_valid,
			</if>
			<if test="remark != null">
				remark,
			</if>
			<if test="inputBy != null">
				input_by,
			</if>
			<if test="inputTime != null">
				input_time,
			</if>
			<if test="updator != null">
				updator,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="exchangeId != null">
				#{exchangeId,jdbcType=BIGINT},
			</if>
			<if test="fullName != null">
				#{fullName,jdbcType=VARCHAR},
			</if>
			<if test="shortName != null">
				#{shortName,jdbcType=VARCHAR},
			</if>
			<if test="isValid != null">
				#{isValid,jdbcType=SMALLINT},
			</if>
			<if test="remark != null">
				#{remark,jdbcType=VARCHAR},
			</if>
			<if test="inputBy != null">
				#{inputBy,jdbcType=VARCHAR},
			</if>
			<if test="inputTime != null">
				#{inputTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updator != null">
				#{updator,jdbcType=VARCHAR},
			</if>
			<if test="updateTime != null">
				#{updateTime,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.huobi.contract.index.entity.ExchangeInfo">
		update exchange_info
		<set>
			<if test="fullName != null">
				full_name = #{fullName,jdbcType=VARCHAR},
			</if>
			<if test="shortName != null">
				short_name = #{shortName,jdbcType=VARCHAR},
			</if>
			<if test="isValid != null">
				is_valid = #{isValid,jdbcType=SMALLINT},
			</if>
			<if test="remark != null">
				remark = #{remark,jdbcType=VARCHAR},
			</if>
			<if test="inputBy != null">
				input_by = #{inputBy,jdbcType=VARCHAR},
			</if>
			<if test="inputTime != null">
				input_time = #{inputTime,jdbcType=TIMESTAMP},
			</if>
			<if test="updator != null">
				updator = #{updator,jdbcType=VARCHAR},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime,jdbcType=TIMESTAMP},
			</if>
		</set>
		where exchange_id = #{exchangeId,jdbcType=BIGINT}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.huobi.contract.index.entity.ExchangeInfo">
    update exchange_info
    set full_name = #{fullName,jdbcType=VARCHAR},
      short_name = #{shortName,jdbcType=VARCHAR},
      is_valid = #{isValid,jdbcType=SMALLINT},
      remark = #{remark,jdbcType=VARCHAR},
      input_by = #{inputBy,jdbcType=VARCHAR},
      input_time = #{inputTime,jdbcType=TIMESTAMP},
      updator = #{updator,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=TIMESTAMP}
    where exchange_id = #{exchangeId,jdbcType=BIGINT}
  </update>
</mapper>